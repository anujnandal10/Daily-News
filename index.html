<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily News Briefing</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- ====== FONTS & BASIC STYLES ====== -->
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Merriweather:wght@300;700&display=swap");

    :root {
      --red: #891400;     /* mast-head colour */
      --text-dark: #111;
      --text-light: #eee;
    }

    body      { margin:0; font-family:Merriweather,serif; background:#fafafa; color:var(--text-dark); line-height:1.5; }
    header    { background:var(--red); color:#fff; padding:1.2rem 1rem; }
    header h1 { margin:0; font-size:2rem; letter-spacing:.5px; }

    main      { max-width:920px; margin:2rem auto; padding:0 1rem; }
    section   { margin-bottom:2.5rem; border-bottom:1px solid #ddd; }
    section:last-child { border:none; }
    h2        { font-size:1.4rem; margin:0 0 1rem; color:var(--red); }

    footer    { font-size:.8rem; text-align:center; color:#666; margin:3rem 0 1rem; }

    /* Collapsible article styling */
    details            { border-left:4px solid var(--red); padding-left:.6rem; margin:.6rem 0 1rem; }
    summary            { list-style:none; cursor:pointer; position:relative; font-weight:700; }
    summary::after     { content:"▼"; font-size:.7rem; position:absolute; right:-1.2rem; top:.1rem; }
    details[open] summary::after { content:"▲"; }
    details p, details ul { margin:.4rem 0; }
    ul { padding-left:1.2rem; }

    /* Dark-mode */
    @media (prefers-color-scheme: dark){
      body   { background:#111; color:var(--text-light); }
      header { background:#b31c1c; }
      h2     { color:#b31c1c; }
      section{ border-color:#444; }
    }
  </style>
</head>

<body>
  <header><h1>Daily News Briefing</h1></header>

  <main id="news"><!-- content injected by JS --></main>

  <footer>© 2025 News Digest · Sources as cited</footer>

  <!-- ====== SCRIPT: fetch markdown & render ====== -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    /* === EDIT THIS PATH EVERY DAY === */
    const markdownUrl = "/news/Daily%20News%202025-06-17.md";
    /* ================================= */

    /* helper: replace any "• " with "- " before parsing
       so lists render as proper bullet <ul> items */
    function normaliseBullets(mdText){
      return mdText.replace(/^• /gm, "- ");
    }

    /* 1) fetch .md  2) convert to HTML  3) restructure into sections  4) wrap articles */
    fetch(markdownUrl)
      .then(r => r.ok ? r.text() : Promise.reject("File not found ("+r.status+")"))
      .then(mdRaw => {
        const md = normaliseBullets(mdRaw);
        const html = marked.parse(md);
        const container = document.getElementById("news");
        container.innerHTML = html;

        /* 3a ► wrap each H2 and following siblings into <section> */
        const nodes = Array.from(container.childNodes);
        let currentSection = null;
        nodes.forEach(node=>{
          if(node.nodeName === "H2"){
            currentSection = document.createElement("section");
            node.before(currentSection);
          }
          currentSection?.appendChild(node);
        });

        /* 4 ► turn each article block inside a section into <details> */
        container.querySelectorAll("section").forEach(section=>{
          // split by <strong> headline
          const parts = Array.from(section.childNodes).filter(n => n !== section.querySelector("h2"));
          let article = null;
          parts.forEach(n=>{
            if(n.querySelector && n.querySelector("strong")){
              article = document.createElement("article");
              section.appendChild(article);
            }
            article?.appendChild(n);
          });

          section.querySelectorAll("article").forEach(art=>{
            const det = document.createElement("details");
            const sum = document.createElement("summary");
            const head = art.querySelector("strong");
            sum.textContent = head ? head.textContent : "Story";
            det.appendChild(sum);
            det.appendChild(art);
            section.appendChild(det);
          });
        });
      })
      .catch(err=>{
        document.getElementById("news").innerHTML =
          `<p style="color:red">Could not load the news file.<br>${err}</p>`;
      });
  </script>
</body>
</html>
